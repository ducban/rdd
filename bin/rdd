#!/usr/bin/env node

'use strict';

var fs = require('fs');
var nopt = require('nopt');
var openBrowser = require('open');
var server = require('../server.js');

var knownOpts = {
  open: [Boolean, String],
  port: Number
};
var shortHands = {
  o: '--open',
  p: '--port'
};
var opts = nopt(knownOpts, shortHands);

var browser = opts.open;
var port = opts.port || 8888;
var url = 'http://localhost:' + port + '/';
var file = opts.argv.remain[0];

if (!file) {
  var file = 'README.md';
  if (!fs.existsSync(file)) {
    var regexp = /^readme.(md|mkdn?|mdown|markdown)$/i;
    var files = fs.readdirSync('./');
    var i = -1;
    var len = files.length;
    while (++i < len) {
      if (regexp.test(files[i])) {
        file = files[i];
        break;
      }
    }
  }
}

server(file, port);

if (browser) {
  if (typeof browser === 'string') {
    openBrowser(url, browser);
  } else {
    openBrowser(url);
  }
}
